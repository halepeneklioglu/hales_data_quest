<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Hale's Data Quest ‚Äì v7 (parallax + sfx)</title>
  <style>
    html,body{margin:0;height:100%;background:#0e0f14}
    #game{display:block;width:100vw;height:100vh}
    .note{position:fixed;top:8px;left:8px;color:#9be9a8;font:14px/1.2 system-ui}
  </style>
</head>
<body>
  <div class="note">‚Üê ‚Üí hareket ‚Ä¢ ‚Üë/Space zƒ±pla ‚Ä¢ Ally'e deƒü = +HP ‚Ä¢ D√º≈üman = hasar ‚Ä¢ Hedef: üíª</div>
  <canvas id="game"></canvas>

  <script src="kaboom.js"></script>
  <script>
  // ---------- BOOT ----------
  const k = kaboom({
    global: true,
    canvas: document.querySelector("#game"),
    width: 960,
    height: 540,
    background: [14,15,20],
    letterbox: true,
  });
  const { add, rect, pos, area, body, color, outline, anchor, text, rgb,
          onKeyDown, onKeyPress, go, scene, shake, destroy, width, height, center, vec2 } = k;

  // ---------- COLORS ----------
  const COL = {
    ink: rgb(20,25,36),
    sky: rgb(12,14,18),
    cityFar: rgb(40,48,70),
    cityNear: rgb(60,70,100),
    ground: rgb(140,160,220),
    coin: rgb(255,222,89),
    // player & people
    hairBrown: rgb(95,60,25), skin: rgb(255,224,189), shirtBlue: rgb(90,160,255), pantsNavy: rgb(40,70,120),
    hairBlack: rgb(20,20,20), hairBlonde: rgb(245,220,120), shirtGreen: rgb(80,200,160), pantsGray: rgb(130,140,150),
    shirtPink: rgb(255,140,170),
    // foes
    red: rgb(255,98,98), violet: rgb(180,130,255), gray: rgb(180,180,200), green: rgb(90,160,90),
    // ui
    white: rgb(255,255,255), cyan: rgb(200,220,255)
  };

  // ---------- SIMPLE WEB AUDIO SFX (no CORS) ----------
  let AC, unlocked = false;
  function ensureAudio() {
    if (!AC) AC = new (window.AudioContext || window.webkitAudioContext)();
    if (AC.state === "suspended") AC.resume();
    unlocked = true;
  }
  function beep(freq=440, dur=0.08, type="square", vol=0.15, when=0) {
    if (!unlocked) return;
    const t = AC.currentTime + (when||0);
    const o = AC.createOscillator();
    const g = AC.createGain();
    o.type = type; o.frequency.setValueAtTime(freq, t);
    g.gain.setValueAtTime(vol, t);
    g.gain.exponentialRampToValueAtTime(0.0001, t + dur);
    o.connect(g).connect(AC.destination);
    o.start(t); o.stop(t + dur);
  }
  const sfx = {
    jump(){ beep(620, 0.06, "square"); beep(880, 0.05, "triangle", 0.12, 0.02); },
    coin(){ beep(880, 0.06, "square"); beep(1320,0.06, "square", 0.12, 0.05); },
    hit(){ beep(180, 0.1, "sawtooth", 0.18); },
    gameOver(){
      // k√º√ß√ºk d√º≈üen arpej
      [660, 520, 390].forEach((f,i)=>beep(f, 0.12, "triangle", 0.18, i*0.12));
    },
    win(){
      // k√º√ß√ºk y√ºkselen motif
      [660, 880, 990, 1320].forEach((f,i)=>beep(f, 0.1, "square", 0.16, i*0.09));
    }
  };
  // kullanƒ±cƒ± ilk tƒ±klamada sesi a√ß
  window.addEventListener("pointerdown", ensureAudio, { once:true });
  window.addEventListener("keydown", ensureAudio, { once:true });

  // ---------- MENU ----------
  scene("menu", () => {
    add([ text("Hale‚Äôs Data Quest", { size: 48, align:"center" }),
          anchor("center"), pos(width()/2, height()/2 - 40), color(COL.white) ]);
    add([ text("Press ENTER or CLICK to start", { size: 22, align:"center" }),
          anchor("center"), pos(width()/2, height()/2 + 20), color(COL.cyan) ]);
    onKeyPress("enter", () => { ensureAudio(); go("game"); });
    onClick(() => { ensureAudio(); go("game"); });
  });

  // ---------- BEHAVIOR ----------
  function patrol(speed=80, range=100) {
    let dir = 1; const org = vec2();
    return {
      id:"patrol", require:["pos"],
      add(){ org.x = this.pos.x; },
      update(){ this.move(speed*dir,0); if (Math.abs(this.pos.x - org.x) > range) dir *= -1; }
    };
  }
  const clamp = (n, lo, hi) => Math.max(lo, Math.min(hi, n));

  // ---------- GAME ----------
  scene("game", () => {
    k.setGravity?.(1600);

    const LEVEL_END = 1950;

    let hp = 5, score = 0, camX = width()/2;

    // HUD
    const hpTxt = add([ text("", {size:24}), color(COL.white), pos(12,12) ]);
    const scTxt = add([ text("", {size:18}), color(COL.cyan),  pos(12,38) ]);
    hpTxt.use?.(k.fixed()); scTxt.use?.(k.fixed());
    const upd = ()=>{ hpTxt.text = "HP: " + "‚ù§".repeat(hp); scTxt.text = "Skor: " + score; }; upd();

    // ---------- PARALLAX BACKGROUND ----------
    // Katman 1: uzak ≈üehir sil√ºeti
    const farGroup = [];
    function addBuildings(group, yBase, count, wMin, wMax, hMin, hMax, col){
      let x = -200;
      for (let i=0;i<count;i++){
        const w = Math.floor(wMin + Math.random()*(wMax-wMin));
        const h = Math.floor(hMin + Math.random()*(hMax-hMin));
        const b = add([ rect(w,h), pos(x, yBase-h), color(col), area(), anchor("topleft") ]);
        group.push({ node:b, baseX:x });
        x += w + 30;
      }
    }
    addBuildings(farGroup, 520, 18, 70, 140, 80, 160, COL.cityFar);

    // Katman 2: yakƒ±n ≈üehir sil√ºeti
    const nearGroup = [];
    addBuildings(nearGroup, 540, 16, 80, 160, 120, 220, COL.cityNear);

    function updateParallax(){
      // camX sol kenarƒ± referansƒ±
      const worldLeft = camX - width()/2;
      // uzak (daha yava≈ü)
      farGroup.forEach(({node, baseX})=>{
        node.pos.x = baseX - worldLeft*0.3;
      });
      // yakƒ±n (biraz hƒ±zlƒ±)
      nearGroup.forEach(({node, baseX})=>{
        node.pos.x = baseX - worldLeft*0.6;
      });
    }

    // Zemin & platformlar
    function platform(x,y,w=200,h=24){
      add([ rect(w,h), pos(x,y), area(), body({isStatic:true}), outline(2, COL.ink), color(COL.ground) ]);
    }
    platform(-40, 500, LEVEL_END + 320, 32);
    platform(220, 420, 200, 24);
    platform(520, 360, 180, 24);
    platform(820, 320, 160, 24);
    platform(1120,360, 200, 24);
    platform(1380,300, 180, 24);
    platform(1700,280, 160, 24);

    // ---------- PLAYER (Hale) ----------
    const p = add([ rect(26,44), pos(60,300), area(), body(),
                    color(COL.shirtBlue), outline(3, rgb(30,25,10)), anchor("center"), "player" ]);
    // sa√ß
    p.add([ pos(0,-16), rect(28,24), anchor("center"), color(COL.hairBrown) ]);
    p.add([ pos(-10,-4), rect(6,20), color(COL.hairBrown) ]);
    p.add([ pos( 10,-4), rect(6,20), color(COL.hairBrown) ]);
    // y√ºz + g√∂z
    p.add([ pos(0,-10), rect(18,16), anchor("center"), color(COL.skin) ]);
    p.add([ pos(-4,-12), rect(3,3), color(0,0,0) ]);
    p.add([ pos( 4,-12), rect(3,3), color(0,0,0) ]);
    // tshirt + pantolon
    p.add([ pos(0,4), rect(24,18), anchor("center"), color(COL.shirtBlue) ]);
    p.add([ pos(-6,18), rect(8,12), color(COL.pantsNavy) ]);
    p.add([ pos( 6,18), rect(8,12), color(COL.pantsNavy) ]);

    // Kamera takibi
    onUpdate(() => {
      const minX = width()/2, maxX = LEVEL_END - width()/2;
      camX = clamp(p.pos.x, minX, maxX);
      k.camPos ? k.camPos(camX, height()/2) : camPos(vec2(camX, height()/2));
      updateParallax();
    });

    // Hareket
    const SPEED=260, JUMP=520;
    onKeyDown("left",  ()=> p.move(-SPEED,0));
    onKeyDown("right", ()=> p.move( SPEED,0));
    function jump(){ if (p.isGrounded()) { p.jump(JUMP); sfx.jump(); } }
    onKeyPress("up", jump); onKeyPress("space", jump);

    // D√º≈üerse
    p.onUpdate(()=>{ if (p.pos.y > 900) { sfx.hit(); damage(1); respawn(); }});
    function respawn(){ p.pos = vec2(60,300); }
    function damage(n=1){ hp -= n; shake(6); if (hp<=0) { sfx.gameOver(); go("over", score); } else upd(); }
    function heal(n=1){ hp = Math.min(5, hp+n); upd(); }
    function gain(n=10){ score += n; upd(); }

    // Label helper
    function labelAbove(obj, t){
      obj.add([ pos(0,-28), text(t,{size:12}), color(235,235,235),
                outline(2, rgb(10,10,10)), anchor("center") ]);
    }

    // ---------- ALLIES (iyile≈ütirir) ----------
    function allyToprak(x,y){
      const a = add([ rect(18,30), pos(x,y), area(), anchor("center"),
                      color(COL.shirtGreen), outline(2,COL.ink), "ally" ]);
      a.add([ pos(0,-14), rect(18,12), anchor("center"), color(COL.hairBrown) ]);
      a.add([ pos(0,-9),  rect(14,10), anchor("center"), color(COL.skin) ]);
      a.add([ pos(-3,-10), rect(2,2), color(0,0,0) ]); // g√∂zler
      a.add([ pos( 3,-10), rect(2,2), color(0,0,0) ]);
      a.add([ pos(0,0), rect(16,12), anchor("center"), color(COL.shirtGreen) ]);
      a.add([ pos(0,10), rect(12,8),  anchor("center"), color(rgb(60,120,200)) ]);
      labelAbove(a, "Toprak ‚ù§Ô∏è"); return a;
    }
    function allyHusband(x,y){
      const a = add([ rect(20,34), pos(x,y), area(), anchor("center"),
                      color(COL.shirtBlue), outline(2,COL.ink), "ally" ]);
      a.add([ pos(0,-16), rect(18,12), anchor("center"), color(COL.hairBlack) ]);
      a.add([ pos(0,-10), rect(14,10), anchor("center"), color(COL.skin) ]);
      a.add([ pos(-3,-12), rect(2,2), color(0,0,0) ]);
      a.add([ pos( 3,-12), rect(2,2), color(0,0,0) ]);
      a.add([ pos(0,2),  rect(16,12), anchor("center"), color(COL.shirtBlue) ]);
      a.add([ pos(0,14), rect(12,10), anchor("center"), color(COL.pantsGray) ]);
      labelAbove(a, "Husband ‚ù§Ô∏è"); return a;
    }
    function allyFriend(x,y){
      const a = add([ rect(20,34), pos(x,y), area(), anchor("center"),
                      color(COL.shirtPink), outline(2,COL.ink), "ally" ]);
      a.add([ pos(0,-16), rect(18,12), anchor("center"), color(COL.hairBlonde) ]);
      a.add([ pos(0,-10), rect(14,10), anchor("center"), color(COL.skin) ]);
      a.add([ pos(-3,-12), rect(2,2), color(0,0,0) ]);
      a.add([ pos( 3,-12), rect(2,2), color(0,0,0) ]);
      a.add([ pos(0,2),  rect(16,12), anchor("center"), color(COL.shirtPink) ]);
      a.add([ pos(0,14), rect(12,10), anchor("center"), color(COL.pantsGray) ]);
      labelAbove(a, "Friend ‚ù§Ô∏è"); return a;
    }

    // ---------- FOES ----------
    function foeADHD(x,y,s=140,r=160){
      const f = add([ rect(40,28), pos(x,y), area(), anchor("center"),
                      color(COL.red), outline(2,COL.ink), "foe", patrol(s,r) ]);
      // dev aƒüƒ±z + di≈ü
      f.add([ pos(0,4), rect(30,9), anchor("center"), color(0,0,0) ]);
      for(let i=-12;i<=12;i+=6){ f.add([ pos(i,2), rect(3,3), color(255,255,255) ]); }
      // 8 g√∂z
      const row = [-12,-4,4,12];
      row.forEach(ex => { f.add([ pos(ex,-8), rect(3,3), color(255,255,255) ]); f.add([ pos(ex,-8), rect(1,1), color(0,0,0) ]); });
      row.forEach(ex => { f.add([ pos(ex,-12), rect(3,3), color(255,255,255) ]); f.add([ pos(ex,-12), rect(1,1), color(0,0,0) ]); });
      // boynuz
      f.add([ pos(-14,-14), rect(4,6), color(COL.red) ]);
      f.add([ pos( 14,-14), rect(4,6), color(COL.red) ]);
      labelAbove(f, "ADHD Monster"); return f;
    }
    function foeTrex(x,y,s=90,r=130){
      const g = add([ rect(46,26), pos(x,y), area(), anchor("center"),
                      color(COL.green), outline(2,COL.ink), "foe", patrol(s,r) ]);
      g.add([ pos(20,-8), rect(18,12), color(COL.green) ]); // kafa
      g.add([ pos(22,-2), rect(16,6),  color(0,0,0) ]);     // aƒüƒ±z bo≈üluƒüu
      for(let i=-6;i<=8;i+=7){ g.add([ pos(22+i,-4), rect(4,2), color(255,255,255) ]); }
      g.add([ pos(-6,2), rect(6,3), color(COL.green) ]);    // minik kollar
      g.add([ pos( 0,2), rect(6,3), color(COL.green) ]);
      g.add([ pos(-8,10), rect(6,6), color(COL.green) ]);   // bacak
      g.add([ pos( 8,10), rect(6,6), color(COL.green) ]);
      g.add([ pos(-22,2), rect(12,6), color(COL.green) ]);  // kuyruk
      labelAbove(g, "Regretourus"); return g;
    }
    function foeGranny(x,y,s=70,r=110){
      const g = add([ rect(24,38), pos(x,y), area(), anchor("center"),
                      color(rgb(160,130,200)), outline(2,COL.ink), "foe", patrol(s,r) ]);
      g.add([ pos(0,-26), rect(16,12), anchor("center"), color(COL.skin) ]); // ba≈ü
      g.add([ pos(0,-32), rect(14,8),  anchor("center"), color(COL.gray) ]); // topuz
      g.add([ pos(-4,-26), rect(6,6), color(COL.gray) ]); // g√∂zl√ºk
      g.add([ pos( 4,-26), rect(6,6), color(COL.gray) ]);
      g.add([ pos( 0,-26), rect(2,2), color(COL.gray) ]);
      g.add([ pos(-4,-26), rect(2,2), color(0,0,0) ]);    // g√∂z
      g.add([ pos( 4,-26), rect(2,2), color(0,0,0) ]);
      g.add([ pos(14,0),  rect(3,22), color(rgb(120,80,40)) ]); // baston
      g.add([ pos(16,10), rect(8,3),  color(rgb(120,80,40)) ]);
      labelAbove(g, "Middle-Aged Monster"); return g;
    }
    function foeOctoWoman(x,y,s=110,r=170){
      const o = add([ rect(26,28), pos(x,y), area(), anchor("center"),
                      color(COL.violet), outline(2,COL.ink), "foe", patrol(s,r) ]);
      o.add([ pos(0,-18), rect(16,12), anchor("center"), color(COL.skin) ]);      // ba≈ü
      o.add([ pos(0,-22), rect(18,10), anchor("center"), color(COL.hairBrown) ]); // sa√ß
      o.add([ pos(-3,-20), rect(2,2), color(0,0,0) ]); // g√∂z
      o.add([ pos( 3,-20), rect(2,2), color(0,0,0) ]);
      const tent = [[-16,10],[-12,12],[-8,14],[-4,12],[4,12],[8,14],[12,12],[16,10]];
      for (const [tx,ty] of tent) o.add([ pos(tx,ty), rect(8,6), color(COL.violet) ]);
      labelAbove(o, "Octo-woman"); return o;
    }

    // Coin & Heart
    function coin(x,y){ return add([ rect(12,12), pos(x,y), area(), anchor("center"), color(COL.coin), outline(2, COL.ink), "coin" ]); }
    function heart(x,y){ return add([ rect(14,12), pos(x,y), area(), anchor("center"), color(255,120,120), outline(2, COL.ink), "heart" ]); }

    // Yerle≈üim
    allyToprak(820,280);
    allyHusband(1180,340);
    allyFriend(1480,260);

    foeADHD(360,380);
    foeTrex(640,340);
    foeGranny(900,340);
    foeOctoWoman(1250,300);

    coin(260,390); coin(780,280); coin(1120,330); coin(1460,260);
    heart(600,330); heart(1380,260);

    // Finish = laptop (ekranda kod satƒ±rlarƒ±)
    const laptop = add([ rect(60,36), pos(1750,262), area(), anchor("center"),
                         color(rgb(60,70,80)), outline(2,COL.ink), "finish" ]);
    laptop.add([ pos(0,-10), rect(52,20), anchor("center"), color(rgb(15,20,28)) ]);
    for(let y=-12; y<=-4; y+=4){ laptop.add([ pos(-20,y), rect(36,1), color(rgb(120,220,160)) ]); }
    laptop.add([ pos(0,10), rect(56,6), anchor("center"), color(rgb(80,90,100)) ]);

    // √áarpƒ±≈ümalar
    p.onCollide("ally",  (a)=>{ heal(1); destroy(a); });
    p.onCollide("foe",   ()=>{ sfx.hit(); damage(1); });
    p.onCollide("coin",  (c)=>{ gain(10); destroy(c); sfx.coin(); });
    p.onCollide("heart", (h)=>{ heal(1); destroy(h); });
    p.onCollide("finish",()=>{ sfx.win(); go("win", score); });
  });

  // ---------- SCENES: OVER / WIN ----------
  scene("over", (score=0) => {
    add([ text("Oyun Bitti", { size: 42, align:"center" }),
          anchor("center"), pos(width()/2, height()/2 - 40), color(COL.white) ]);
    add([ text("Skor: " + score, { size: 28, align:"center" }),
          anchor("center"), pos(width()/2, height()/2), color(COL.cyan) ]);
    add([ text("May the Data be with You ‚ú®", { size: 22, align:"center" }),
          anchor("center"), pos(width()/2, height()/2 + 40), color(COL.white) ]);
    add([ text("[R] Restart   |   [M] Menu", { size: 16, align:"center" }),
          anchor("center"), pos(width()/2, height()/2 + 88), color(rgb(200,200,200)) ]);
    onKeyPress("r", ()=> { ensureAudio(); go("game"); });
    onKeyPress("m", ()=> go("menu"));
    onClick(()=> { ensureAudio(); go("game"); });
  });

  scene("win", (score=0) => {
    add([ text("Mission Complete!", { size: 42, align:"center" }),
          anchor("center"), pos(width()/2, height()/2 - 40), color(COL.white) ]);
    add([ text("Skor: " + score, { size: 28, align:"center" }),
          anchor("center"), pos(width()/2, height()/2), color(COL.cyan) ]);
    add([ text("May the Data be with You ‚ú®", { size: 22, align:"center" }),
          anchor("center"), pos(width()/2, height()/2 + 40), color(COL.white) ]);
    add([ text("[R] Restart   |   [M] Menu", { size: 16, align:"center" }),
          anchor("center"), pos(width()/2, height()/2 + 88), color(rgb(200,200,200)) ]);
    onKeyPress("r", ()=> { ensureAudio(); go("game"); });
    onKeyPress("m", ()=> go("menu"));
    onClick(()=> { ensureAudio(); go("game"); });
  });

  // start
  go("menu");
  </script>
</body>
</html>
