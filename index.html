<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Hale's Data Quest – v4 (camera)</title>
  <style>
    html,body{margin:0;height:100%;background:#0e0f14}
    #game{display:block;width:100vw;height:100vh}
    .note{position:fixed;top:8px;left:8px;color:#9be9a8;font:14px/1.2 system-ui}
  </style>
</head>
<body>
  <div class="note">← → hareket • ↑ / Space zıpla • Toprak=❤️ • Düşman=hasar</div>
  <canvas id="game"></canvas>

  <!-- Önerilen kaboom: 3000.1.17 (aynı klasörde) -->
  <script src="kaboom.js"></script>
  <script>
  // -------- KABOOM BOOT --------
  const k = kaboom({
    global: true,
    canvas: document.querySelector("#game"),
    width: 960,
    height: 540,
    background: [14,15,20],
    letterbox: true,
  });
  const { add, rect, pos, area, body, color, outline, anchor, text, rgb,
          onKeyDown, onKeyPress, go, scene, shake, destroy, width, height, center, vec2, camPos } = k;

  // küçük yardımcı
  const clamp = (n, lo, hi) => Math.max(lo, Math.min(hi, n));

  // -------- RENKLER --------
  const COL = {
    player: rgb(255,207,64), ground: rgb(140,160,220), friend: rgb(155,233,168),
    foe: rgb(255,98,98), coin: rgb(255,222,89), ink: rgb(20,25,36),
    purple: rgb(180,130,255), gray: rgb(180,180,200), green: rgb(120,220,150)
  };

  // -------- SAHNE: MENÜ --------
  scene("menu", () => {
    add([ text("Hale’s Data Quest", { size: 48, align:"center" }),
          anchor("center"), pos(width()/2, height()/2 - 40), color(255,255,255) ]);

    add([ text("Press ENTER or CLICK to start", { size: 22, align:"center" }),
          anchor("center"), pos(width()/2, height()/2 + 20), color(200,220,255) ]);

    // dekor
    add([ rect(40,60), pos(width()/2 - 150, height()/2 + 100),
          color(COL.player), outline(3, rgb(30,25,10)) ]);
    add([ rect(22,22), pos(width()/2 + 110, height()/2 + 110),
          color(COL.friend), outline(2, COL.ink) ]);

    onKeyPress("enter", () => go("game"));
    onClick(() => go("game"));
  });

  // -------- ORTAK: devriye davranışı --------
  function patrol(speed=80, range=100) {
    let dir = 1; const org = vec2();
    return {
      id: "patrol", require: ["pos"],
      add(){ org.x = this.pos.x; },
      update(){ this.move(speed*dir, 0); if (Math.abs(this.pos.x - org.x) > range) dir *= -1; }
    };
  }

  // -------- SAHNE: OYUN --------
  scene("game", () => {
    if (typeof k.setGravity === "function") k.setGravity(1600);

    // Level uzunluğu (kamerayı bu aralıkta tutacağız)
    const LEVEL_END = 1750;

    let hp = 5, score = 0;

    // UI → ekrana sabit
    const hpTxt = add([ text("", {size:24}), color(255,255,255), pos(12,12) ]);
    const scTxt = add([ text("", {size:18}), color(180,220,255), pos(12,38) ]);
    if (typeof k.fixed === "function") { hpTxt.use(k.fixed()); scTxt.use(k.fixed()); }
    const upd = () => { hpTxt.text = "HP: " + "❤".repeat(hp); scTxt.text = "Skor: " + score; };
    upd();

    // Zemin & platformlar
    function platform(x,y,w=200,h=24){
      add([ rect(w,h), pos(x,y), area(), body({isStatic:true}), outline(2, COL.ink), color(COL.ground) ]);
    }
    const floorY = 500;
    platform(-40, floorY, LEVEL_END + 200, 32);   // zemini level sonuna kadar uzat
    platform(220, 420, 200, 24);
    platform(520, 360, 180, 24);
    platform(780, 300, 180, 24);
    platform(1120,360, 200, 24);
    platform(1380,300, 180, 24);

    // Oyuncu (Hale)
    const p = add([
      rect(28,40), pos(60,300), area(), body(),
      color(COL.player), outline(3, rgb(30,25,10)), anchor("center")
    ]);
    p.add([pos(-6,-5), rect(6,6), color(0,0,0)]);
    p.add([pos( 6,-5), rect(6,6), color(0,0,0)]);

    // Kamera → oyuncuyu takip et (clamp ile sınırla)
    onUpdate(() => {
      const x = clamp(p.pos.x, width()/2, LEVEL_END - width()/2);
      camPos(vec2(x, height()/2));
    });

    // Hareket
    const SPEED=260, JUMP=520;
    onKeyDown("left",  ()=> p.move(-SPEED,0));
    onKeyDown("right", ()=> p.move( SPEED,0));
    function jump(){ if (p.isGrounded()) p.jump(JUMP); }
    onKeyPress("up", jump); onKeyPress("space", jump);

    // Düşerse
    p.onUpdate(()=>{ if (p.pos.y > 900) { damage(1); respawn(); }});
    function respawn(){ p.pos = vec2(60,300); }
    function damage(n=1){ hp -= n; shake(6); if (hp<=0) go("over", score); else upd(); }
    function heal(n=1){ hp = Math.min(5, hp+n); upd(); }
    function gain(n=10){ score += n; upd(); }

    // Etiket helper
    function addLabel(obj, t){
      obj.add([ pos(0,-26), text(t,{size:12}), color(235,235,235), outline(2, rgb(10,10,10)), anchor("center") ]);
    }

    // Toprak (iyileştirir)
    function friend(x,y){
      const f = add([ rect(20,26), pos(x,y), area(), anchor("center"),
                      color(COL.friend), outline(2, COL.ink), "friend" ]);
      addLabel(f, "Toprak ❤️");
      return f;
    }

    // Düşmanlar
    function foe_red(x,y,s=120,r=140,txt="ADHD Monster"){
      const e = add([ rect(28,24), pos(x,y), area(), anchor("center"),
                       color(COL.foe), outline(2, COL.ink), "foe", patrol(s,r) ]);
      addLabel(e, txt); return e;
    }
    function foe_gray(x,y,s=90,r=120,txt="Regretourus"){
      const e = add([ rect(34,22), pos(x,y), area(), anchor("center"),
                       color(COL.gray), outline(2, COL.ink), "foe", patrol(s,r) ]);
      addLabel(e, txt); return e;
    }
    function foe_green(x,y,s=60,r=90,txt="Middle-Aged Monster"){
      const e = add([ rect(26,24), pos(x,y), area(), anchor("center"),
                       color(COL.green), outline(2, COL.ink), "foe", patrol(s,r) ]);
      addLabel(e, txt); return e;
    }
    function foe_purple(x,y,s=100,r=160,txt="Octopus-Woman"){
      const e = add([ rect(24,24), pos(x,y), area(), anchor("center"),
                       color(COL.purple), outline(2, COL.ink), "foe", patrol(s,r) ]);
      addLabel(e, txt); return e;
    }

    // Coin & Heart
    function coin(x,y){
      return add([ rect(12,12), pos(x,y), area(), anchor("center"),
                   color(COL.coin), outline(2, COL.ink), "coin" ]);
    }
    function heart(x,y){
      return add([ rect(14,12), pos(x,y), area(), anchor("center"),
                   color(255,120,120), outline(2, COL.ink), "heart" ]);
    }

    // Yerleşim
    friend(820,260); friend(1420,260);
    foe_red(360,380); foe_gray(640,340);
    foe_green(900, 340, 70, 100, "Middle-Aged Monster");
    foe_purple(1250, 300, 110, 160, "Octopus-Woman");

    coin(260,390); coin(780,280); coin(1180,330); coin(1460,260);
    heart(600, 330); heart(1280, 280);

    // Finish bayrağı
    const finish = add([
      rect(18, 60), pos(1650, 260), area(),
      color(255,230,120), outline(2, COL.ink), "finish"
    ]);

    // Çarpışmalar
    p.onCollide("friend", (f)=>{ heal(1); destroy(f); });
    p.onCollide("foe",    ()=>{ damage(1); });
    p.onCollide("coin",   (c)=>{ gain(10); destroy(c); });
    p.onCollide("heart",  (h)=>{ heal(1); destroy(h); });
    p.onCollide("finish", ()=>{ go("win", score); });
  });

  // -------- SAHNE: GAME OVER --------
  scene("over", (score=0) => {
    add([ text("Oyun Bitti", { size: 42, align:"center" }),
          anchor("center"), pos(width()/2, height()/2 - 40), color(255,255,255) ]);
    add([ text("Skor: " + score, { size: 28, align:"center" }),
          anchor("center"), pos(width()/2, height()/2), color(200,220,255) ]);
    add([ text("May the Data be with You ✨", { size: 22, align:"center" }),
          anchor("center"), pos(width()/2, height()/2 + 40), color(255,255,255) ]);
    add([ text("[R] Restart   |   [M] Menu", { size: 16, align:"center" }),
          anchor("center"), pos(width()/2, height()/2 + 88), color(200,200,200) ]);

    onKeyPress("r", ()=> go("game"));
    onKeyPress("m", ()=> go("menu"));
    onClick(()=> go("game"));
  });

  // -------- SAHNE: WIN --------
  scene("win", (score=0) => {
    add([ text("Mission Complete!", { size: 42, align: "center" }),
          anchor("center"), pos(width()/2, height()/2 - 40), color(255,255,255) ]);
    add([ text("Skor: " + score, { size: 28, align: "center" }),
          anchor("center"), pos(width()/2, height()/2), color(200,220,255) ]);
    add([ text("May the Data be with You ✨", { size: 22, align: "center" }),
          anchor("center"), pos(width()/2, height()/2 + 40), color(255,255,255) ]);
    add([ text("[R] Restart   |   [M] Menu", { size: 16, align: "center" }),
          anchor("center"), pos(width()/2, height()/2 + 88), color(200,200,200) ]);
    onKeyPress("r", ()=> go("game"));
    onKeyPress("m", ()=> go("menu"));
    onClick(()=> go("game"));
  });

  // Başlangıç
  go("menu");
  </script>
</body>
</html>
