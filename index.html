<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Hale's Data Quest – v5 (camera + visuals)</title>
  <style>
    html,body{margin:0;height:100%;background:#0e0f14}
    #game{display:block;width:100vw;height:100vh}
    .note{position:fixed;top:8px;left:8px;color:#9be9a8;font:14px/1.2 system-ui}
  </style>
</head>
<body>
  <div class="note">← → hareket • ↑ / Space zıpla • Toprak=❤️ • Düşman=hasar</div>
  <canvas id="game"></canvas>

  <script src="kaboom.js"></script>
  <script>
  const k = kaboom({
    global: true,
    canvas: document.querySelector("#game"),
    width: 960,
    height: 540,
    background: [14,15,20],
    letterbox: true,
  });
  const { add, rect, pos, area, body, color, outline, anchor, text, rgb,
          onKeyDown, onKeyPress, go, scene, shake, destroy, width, height, center, vec2 } = k;

  // renkler
  const COL = {
    hair: rgb(95, 60, 25), skin: rgb(255,224,189), shirt: rgb(90,160,255), pants: rgb(40,70,120),
    player: rgb(255,207,64), ground: rgb(140,160,220), friend: rgb(155,233,168),
    foeR: rgb(255,98,98), foeG: rgb(120,220,150), foeP: rgb(180,130,255), foeGray: rgb(180,180,200),
    coin: rgb(255,222,89), ink: rgb(20,25,36)
  };

  // menü
  scene("menu", () => {
    add([ text("Hale’s Data Quest", { size: 48, align:"center" }),
          anchor("center"), pos(width()/2, height()/2 - 40), color(255,255,255) ]);
    add([ text("Press ENTER or CLICK to start", { size: 22, align:"center" }),
          anchor("center"), pos(width()/2, height()/2 + 20), color(200,220,255) ]);
    add([ rect(40,60), pos(width()/2 - 150, height()/2 + 100),
          color(COL.player), outline(3, rgb(30,25,10)) ]);
    add([ rect(22,22), pos(width()/2 + 110, height()/2 + 110),
          color(COL.friend), outline(2, COL.ink) ]);
    onKeyPress("enter", () => go("game"));
    onClick(() => go("game"));
  });

  // devriye davranışı
  function patrol(speed=80, range=100) {
    let dir = 1; const org = vec2();
    return {
      id: "patrol", require: ["pos"],
      add(){ org.x = this.pos.x; },
      update(){ this.move(speed*dir, 0); if (Math.abs(this.pos.x - org.x) > range) dir *= -1; }
    };
  }

  // oyun
  scene("game", () => {
    if (typeof k.setGravity === "function") k.setGravity(1600);

    // level genişliği (kamerayı sınırlarız)
    const LEVEL_END = 1750;

    let hp = 5, score = 0;

    // HUD ekrana sabit
    const hpTxt = add([ text("", {size:24}), color(255,255,255), pos(12,12) ]);
    const scTxt = add([ text("", {size:18}), color(180,220,255), pos(12,38) ]);
    if (typeof k.fixed === "function") { hpTxt.use(k.fixed()); scTxt.use(k.fixed()); }
    const upd = () => { hpTxt.text = "HP: " + "❤".repeat(hp); scTxt.text = "Skor: " + score; };
    upd();

    // platformlar
    function platform(x,y,w=200,h=24){
      add([ rect(w,h), pos(x,y), area(), body({isStatic:true}), outline(2, COL.ink), color(COL.ground) ]);
    }
    platform(-40, 500, LEVEL_END + 260, 32);
    platform(220, 420, 200, 24);
    platform(520, 360, 180, 24);
    platform(780, 300, 180, 24);
    platform(1120,360, 200, 24);
    platform(1380,300, 180, 24);

    // ---- HALE (insan görünüm) ----
    // hitbox: ana rect; üstüne saç/baş/tişört/pantolon çocukları çiziyoruz
    const p = add([
      rect(26,44), pos(60,300), area(), body(),
      color(COL.shirt), outline(3, rgb(30,25,10)), anchor("center"), "player"
    ]);
    // saç (uzun kahverengi)
    p.add([ pos(0,-16), rect(28,24), anchor("center"), color(COL.hair) ]);
    p.add([ pos(-10,-4), rect(6,20), color(COL.hair) ]); // sol saç tutamı
    p.add([ pos( 10,-4), rect(6,20), color(COL.hair) ]); // sağ saç tutamı
    // yüz
    p.add([ pos(0,-10), rect(18,16), anchor("center"), color(COL.skin) ]);
    p.add([ pos(-4,-12), rect(3,3), color(0,0,0) ]);
    p.add([ pos( 4,-12), rect(3,3), color(0,0,0) ]);
    // tişört (gövde)
    p.add([ pos(0,4), rect(24,18), anchor("center"), color(COL.shirt) ]);
    // pantolon
    p.add([ pos(-6,18), rect(8,12), color(COL.pants) ]);
    p.add([ pos( 6,18), rect(8,12), color(COL.pants) ]);

    // KAMERA TAKİBİ — robust
    const clamp = (n, lo, hi) => Math.max(lo, Math.min(hi, n));
    onUpdate(() => {
      const minX = width()/2;
      const maxX = LEVEL_END - width()/2;
      const cx = clamp(p.pos.x, minX, maxX);
      // Bazı sürümlerde global camPos yerine k.camPos gerekebilir:
      if (typeof k.camPos === "function") k.camPos(cx, height()/2);
      else if (typeof camPos === "function") camPos(vec2(cx, height()/2));
    });

    // hareket
    const SPEED=260, JUMP=520;
    onKeyDown("left",  ()=> p.move(-SPEED,0));
    onKeyDown("right", ()=> p.move( SPEED,0));
    function jump(){ if (p.isGrounded()) p.jump(JUMP); }
    onKeyPress("up", jump); onKeyPress("space", jump);

    // düşerse
    p.onUpdate(()=>{ if (p.pos.y > 900) { damage(1); respawn(); }});
    function respawn(){ p.pos = vec2(60,300); }
    function damage(n=1){ hp -= n; shake(6); if (hp<=0) go("over", score); else upd(); }
    function heal(n=1){ hp = Math.min(5, hp+n); upd(); }
    function gain(n=10){ score += n; upd(); }

    // label helper
    function addLabel(obj, t){
      obj.add([ pos(0,-26), text(t,{size:12}), color(235,235,235),
                outline(2, rgb(10,10,10)), anchor("center") ]);
    }

    // arkadaş (Toprak)
    function friend(x,y){
      const f = add([ rect(20,26), pos(x,y), area(), anchor("center"),
                      color(COL.friend), outline(2, COL.ink), "friend" ]);
      addLabel(f, "Toprak ❤️");
      return f;
    }

    // canavar/dino düşmanlar (basit “piksel-art” şekiller)
    function foe_dino(x,y,s=80,r=120,txt="Regretourus"){
      const e = add([ rect(36,24), pos(x,y), area(), anchor("center"),
                       color(COL.foeGray), outline(2,COL.ink), "foe", patrol(s,r) ]);
      // kafa
      e.add([ pos(16,-10), rect(14,12), color(COL.foeGray) ]);
      // dişler
      e.add([ pos(20,-6), rect(4,2), color(255,255,255) ]);
      e.add([ pos(24,-6), rect(4,2), color(255,255,255) ]);
      // kısa kol/bacak
      e.add([ pos(-10,10), rect(6,6), color(COL.foeGray) ]);
      e.add([ pos( 12,10), rect(6,6), color(COL.foeGray) ]);
      addLabel(e, txt); return e;
    }
    function foe_octopus(x,y,s=110,r=160,txt="Octopus-Woman"){
      const e = add([ rect(26,24), pos(x,y), area(), anchor("center"),
                       color(COL.foeP), outline(2,COL.ink), "foe", patrol(s,r) ]);
      // kollar
      e.add([ pos(-14,10), rect(8,6), color(COL.foeP) ]);
      e.add([ pos( 14,10), rect(8,6), color(COL.foeP) ]);
      e.add([ pos(0,12), rect(10,6), color(COL.foeP) ]);
      addLabel(e, txt); return e;
    }
    function foe_imp(x,y,s=120,r=140,txt="ADHD Monster"){
      const e = add([ rect(28,24), pos(x,y), area(), anchor("center"),
                       color(COL.foeR), outline(2, COL.ink), "foe", patrol(s,r) ]);
      // kulak/çıkıntı
      e.add([ pos(-10,-10), rect(6,8), color(COL.foeR) ]);
      e.add([ pos( 10,-10), rect(6,8), color(COL.foeR) ]);
      addLabel(e, txt); return e;
    }
    function foe_ogre(x,y,s=70,r=100,txt="Middle-Aged Monster"){
      const e = add([ rect(26,28), pos(x,y), area(), anchor("center"),
                       color(COL.foeG), outline(2, COL.ink), "foe", patrol(s,r) ]);
      e.add([ pos(0,-14), rect(18,10), anchor("center"), color(COL.foeG) ]);
      e.add([ pos(-5,-16), rect(3,3), color(0,0,0) ]);
      e.add([ pos( 5,-16), rect(3,3), color(0,0,0) ]);
      addLabel(e, txt); return e;
    }

    // coin & heart
    function coin(x,y){ return add([ rect(12,12), pos(x,y), area(), anchor("center"),
                                     color(COL.coin), outline(2, COL.ink), "coin" ]); }
    function heart(x,y){ return add([ rect(14,12), pos(x,y), area(), anchor("center"),
                                      color(255,120,120), outline(2, COL.ink), "heart" ]); }

    // yerleşim
    friend(820,260); friend(1420,260);

    foe_imp(360,380,120,140,"ADHD Monster");
    foe_dino(640,340,90,120,"Regretourus");
    foe_ogre(900,340,70,100,"Middle-Aged Monster");
    foe_octopus(1250,300,110,160,"Octopus-Woman");

    coin(260,390); coin(780,280); coin(1180,330); coin(1460,260);
    heart(600,330); heart(1280,280);

    // finish
    add([ rect(18, 60), pos(1650, 260), area(),
          color(255,230,120), outline(2, COL.ink), "finish" ]);

    // çarpışmalar
    p.onCollide("friend", (f)=>{ heal(1); destroy(f); });
    p.onCollide("foe",    ()=>{ damage(1); });
    p.onCollide("coin",   (c)=>{ gain(10); destroy(c); });
    p.onCollide("heart",  (h)=>{ heal(1); destroy(h); });
    p.onCollide("finish", ()=>{ go("win", score); });
  });

  // game over
  scene("over", (score=0) => {
    add([ text("Oyun Bitti", { size: 42, align:"center" }),
          anchor("center"), pos(width()/2, height()/2 - 40), color(255,255,255) ]);
    add([ text("Skor: " + score, { size: 28, align:"center" }),
          anchor("center"), pos(width()/2, height()/2), color(200,220,255) ]);
    add([ text("May the Data be with You ✨", { size: 22, align:"center" }),
          anchor("center"), pos(width()/2, height()/2 + 40), color(255,255,255) ]);
    add([ text("[R] Restart   |   [M] Menu", { size: 16, align:"center" }),
          anchor("center"), pos(width()/2, height()/2 + 88), color(200,200,200) ]);
    onKeyPress("r", ()=> go("game"));
    onKeyPress("m", ()=> go("menu"));
    onClick(()=> go("game"));
  });

  // win
  scene("win", (score=0) => {
    add([ text("Mission Complete!", { size: 42, align: "center" }),
          anchor("center"), pos(width()/2, height()/2 - 40), color(255,255,255) ]);
    add([ text("Skor: " + score, { size: 28, align: "center" }),
          anchor("center"), pos(width()/2, height()/2), color(200,220,255) ]);
    add([ text("May the Data be with You ✨", { size: 22, align: "center" }),
          anchor("center"), pos(width()/2, height()/2 + 40), color(255,255,255) ]);
    add([ text("[R] Restart   |   [M] Menu", { size: 16, align: "center" }),
          anchor("center"), pos(width()/2, height()/2 + 88), color(200,200,200) ]);
    onKeyPress("r", ()=> go("game"));
    onKeyPress("m", ()=> go("menu"));
    onClick(()=> go("game"));
  });

  go("menu");
  </script>
</body>
</html>
